//failed business

Select 
  A.*,
  B.start_week,
  B.start_month,
  B.start_quarter,
  B.lang,
  B.Channel,
  B.ldap,
  B.quality_reviewer,
  B.wave

from (select 
case_id, 
review_date,
review_week,
_2b1_category as selected_option
  
from google.pos_qa_internal_jp
WHERE _2b1_category is not null and _2b1_category <>'None'

union all


select 
case_id,  
review_date,
review_week,
b3_missed_category as selected_option
  
from google.pos_qa_internal_jp
WHERE b3_missed_category is not null

union all

select 
case_id,  
review_date,
review_week,
b5_missed_category as selected_option,
  
from google.pos_qa_internal_jp
WHERE b5_missed_category is not null

union all

select 
case_id,  
review_date,
review_week,
b6_missed_category as selected_option,
  
from google.pos_qa_internal_jp
WHERE b6_missed_category is not null) A
Left Join 
  
(select 
case_id,
CAST(case_start_day as DATE) as start_day,
CAST(case_start_week as DATE) as start_week,
CAST(FORMAT_DATE('%F',DATE_TRUNC(CAST(case_start_day AS DATE), MONTH)) AS DATE) AS start_month,
case_start_quarter as start_quarter,
CASE WHEN locale ='ko' THEN 'Korean'
WHEN locale = 'ja' THEN 'Japanese' ELSE NULL END as lang,
opening_channel as Channel,
task_owner as ldap,
quality_reviewer,
grade,
stage,
evaluation_score,
final_alignment_score,
is_aligned,
is_calib_stage,
CASE WHEN category='primary dsat category' THEN NULL 
WHEN evaluation_score>=90 THEN 1 ELSE 0 END as Pass,
CAST(case_closed_week as DATE) as case_closed_week,
CAST(FORMAT_DATE('%F',DATE_TRUNC(CAST(case_closed_day AS DATE), MONTH)) AS DATE) AS case_closed_month,
CAST(qplus_review_week as DATE) as qplus_review_week,
CAST(qplus_review_month as DATE) as qplus_review_month,
CAST(survey_response_day as DATE) as survey_response_day,
queue,
neo_feature,
neo_component,
neo_component_detail,
neo_request,
wave,
COUNT(DISTINCT case_id) as case_ct



from (
    SELECT *,
    NULL as is_aligned_v2
    FROM youtube_creator_support_dremel.qplus
    left join google.POS_agentlist
    on task_owner=ldap
        
    WHERE review_type = 'QA Review'
    AND queue_site='SEO'
    AND stage in ('QA (TVC review)')
    AND queue in ('[SEO] QA Core (new)'))
GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27) B
on A.case_id = B.case_id
